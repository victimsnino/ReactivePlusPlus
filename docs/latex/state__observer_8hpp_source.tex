\hypertarget{state__observer_8hpp_source}{}\doxysection{state\+\_\+observer.\+hpp}
\label{state__observer_8hpp_source}\index{src/rpp/rpp/observers/state\_observer.hpp@{src/rpp/rpp/observers/state\_observer.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//                  ReactivePlusPlus library}}
\DoxyCodeLine{2 \textcolor{comment}{//}}
\DoxyCodeLine{3 \textcolor{comment}{//          Copyright Aleksey Loginov 2022 -\/ present.}}
\DoxyCodeLine{4 \textcolor{comment}{// Distributed under the Boost Software License, Version 1.0.}}
\DoxyCodeLine{5 \textcolor{comment}{//    (See accompanying file LICENSE\_1\_0.txt or copy at}}
\DoxyCodeLine{6 \textcolor{comment}{//          https://www.boost.org/LICENSE\_1\_0.txt)}}
\DoxyCodeLine{7 \textcolor{comment}{//}}
\DoxyCodeLine{8 \textcolor{comment}{// Project home: https://github.com/victimsnino/ReactivePlusPlus}}
\DoxyCodeLine{9 \textcolor{comment}{//}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <rpp/observers/interface\_observer.hpp>}     \textcolor{comment}{// base class}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <rpp/subscribers/constraints.hpp>}          \textcolor{comment}{// default forwarding functors}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <rpp/utils/function\_traits.hpp>}            \textcolor{comment}{// extract argument type}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <rpp/subscribers/specific\_subscriber.hpp>}  \textcolor{comment}{// create proxy subscriber}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <exception>}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{namespace }rpp::details}
\DoxyCodeLine{21 \{}
\DoxyCodeLine{22 \textcolor{keyword}{struct }forwarding\_on\_next}
\DoxyCodeLine{23 \{}
\DoxyCodeLine{24     \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::subscriber TSub>}
\DoxyCodeLine{25     \textcolor{keywordtype}{void} operator()(\textcolor{keyword}{auto}\&\& v, TSub\&\& sub)\textcolor{keyword}{ const }\{ sub.on\_next(std::forward<\textcolor{keyword}{decltype}(v)>(v)); \}}
\DoxyCodeLine{26 \};}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{struct }forwarding\_on\_error}
\DoxyCodeLine{29 \{}
\DoxyCodeLine{30     \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::subscriber TSub>}
\DoxyCodeLine{31     \textcolor{keywordtype}{void} operator()(\textcolor{keyword}{const} std::exception\_ptr\& err, TSub\&\& sub)\textcolor{keyword}{ const }\{sub.on\_error(err);\}}
\DoxyCodeLine{32 \};}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{keyword}{struct }forwarding\_on\_completed}
\DoxyCodeLine{35 \{}
\DoxyCodeLine{36     \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::subscriber TSub>}
\DoxyCodeLine{37     \textcolor{keywordtype}{void} operator()(TSub\&\& sub)\textcolor{keyword}{ const }\{sub.on\_completed();\}}
\DoxyCodeLine{38 \};}
\DoxyCodeLine{39 }
\DoxyCodeLine{43 \textcolor{keyword}{template}<constraint::decayed\_type T,}
\DoxyCodeLine{44          constraint::decayed\_type State,}
\DoxyCodeLine{45          std::invocable<T, State>                  OnNext = forwarding\_on\_next,}
\DoxyCodeLine{46          std::invocable<std::exception\_ptr, State> OnError = forwarding\_on\_error,}
\DoxyCodeLine{47          std::invocable<State>                     OnCompleted= forwarding\_on\_completed>}
\DoxyCodeLine{48 \textcolor{keyword}{class }state\_observer final : \textcolor{keyword}{public} interface\_observer<T>}
\DoxyCodeLine{49 \{}
\DoxyCodeLine{50 \textcolor{keyword}{public}:}
\DoxyCodeLine{51     state\_observer(constraint::decayed\_same\_as<State> \textcolor{keyword}{auto}\&\&        state,}
\DoxyCodeLine{52                    std::invocable<T, State> \textcolor{keyword}{auto}\&\&                  on\_next,}
\DoxyCodeLine{53                    std::invocable<std::exception\_ptr, State> \textcolor{keyword}{auto}\&\& on\_error,}
\DoxyCodeLine{54                    std::invocable<State> \textcolor{keyword}{auto}\&\&                     on\_completed)}
\DoxyCodeLine{55         : m\_state\{std::forward<decltype(state)>(state)\}}
\DoxyCodeLine{56         , m\_on\_next\{std::forward<decltype(on\_next)>(on\_next)\}}
\DoxyCodeLine{57         , m\_on\_err\{std::forward<decltype(on\_error)>(on\_error)\}}
\DoxyCodeLine{58         , m\_on\_completed\{std::forward<decltype(on\_completed)>(on\_completed)\} \{\}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60     state\_observer(\textcolor{keyword}{const} state\_observer<T, State, OnNext, OnError, OnCompleted>\& other)     = \textcolor{keywordflow}{default};}
\DoxyCodeLine{61     state\_observer(state\_observer<T, State, OnNext, OnError, OnCompleted>\&\& other) \textcolor{keyword}{noexcept} = \textcolor{keywordflow}{default};}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{keywordtype}{void} on\_next(\textcolor{keyword}{const} T\& v)\textcolor{keyword}{ const override                     }\{ m\_on\_next(v, m\_state);             \}}
\DoxyCodeLine{64     \textcolor{keywordtype}{void} on\_next(T\&\& v)\textcolor{keyword}{ const override                          }\{ m\_on\_next(std::move(v), m\_state);  \}}
\DoxyCodeLine{65     \textcolor{keywordtype}{void} on\_error(\textcolor{keyword}{const} std::exception\_ptr\& err)\textcolor{keyword}{ const override }\{ m\_on\_err(err, m\_state);            \}}
\DoxyCodeLine{66     \textcolor{keywordtype}{void} on\_completed()\textcolor{keyword}{ const override                          }\{ m\_on\_completed(m\_state);         \}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{keyword}{private}:}
\DoxyCodeLine{69     State                             m\_state;}
\DoxyCodeLine{70     [[no\_unique\_address]] OnNext      m\_on\_next;}
\DoxyCodeLine{71     [[no\_unique\_address]] OnError     m\_on\_err;}
\DoxyCodeLine{72     [[no\_unique\_address]] OnCompleted m\_on\_completed;}
\DoxyCodeLine{73 \};}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{keyword}{template}<\textcolor{keyword}{typename} TState, \textcolor{keyword}{typename} TOnNext, \textcolor{keyword}{typename} ...Args>}
\DoxyCodeLine{76 state\_observer(TState, TOnNext, Args...) -\/> state\_observer<std::decay\_t<utils::function\_argument\_t<TOnNext>>, TState, TOnNext, Args...>;}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \textcolor{keyword}{template}<constraint::decayed\_type                            Type, }
\DoxyCodeLine{79          \textcolor{keyword}{typename}                                            State,}
\DoxyCodeLine{80          std::invocable<Type, State>                         OnNext, }
\DoxyCodeLine{81          std::invocable<std::exception\_ptr, State>           OnError, }
\DoxyCodeLine{82          std::invocable<State>                               OnCompleted, }
\DoxyCodeLine{83          constraint::decayed\_same\_as<composite\_subscription> Subscription = composite\_subscription>}
\DoxyCodeLine{84 \textcolor{keyword}{auto} create\_subscriber\_with\_state\_impl(State\&\&        state,}
\DoxyCodeLine{85                                        OnNext\&\&       on\_next,}
\DoxyCodeLine{86                                        OnError\&\&      on\_error,}
\DoxyCodeLine{87                                        OnCompleted\&\&  on\_completed,}
\DoxyCodeLine{88                                        Subscription\&\& sub = composite\_subscription\{\})}
\DoxyCodeLine{89 \{}
\DoxyCodeLine{90     \textcolor{keywordflow}{return} specific\_subscriber<Type, state\_observer<Type,}
\DoxyCodeLine{91                                                     std::decay\_t<State>,}
\DoxyCodeLine{92                                                     std::decay\_t<OnNext>,}
\DoxyCodeLine{93                                                     std::decay\_t<OnError>,}
\DoxyCodeLine{94                                                     std::decay\_t<OnCompleted>>>}
\DoxyCodeLine{95     \{}
\DoxyCodeLine{96         std::forward<Subscription>(sub),}
\DoxyCodeLine{97         std::forward<State>(state),}
\DoxyCodeLine{98         std::forward<OnNext>(on\_next),}
\DoxyCodeLine{99         std::forward<OnError>(on\_error),}
\DoxyCodeLine{100         std::forward<OnCompleted>(on\_completed)}
\DoxyCodeLine{101     \};}
\DoxyCodeLine{102 \}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 \textcolor{keyword}{template}<constraint::decayed\_type                  Type, }
\DoxyCodeLine{105          \textcolor{keyword}{typename}                                  State,}
\DoxyCodeLine{106          std::invocable<Type, State>               OnNext, }
\DoxyCodeLine{107          std::invocable<std::exception\_ptr, State> OnError, }
\DoxyCodeLine{108          std::invocable<State>                     OnCompleted>}
\DoxyCodeLine{109 \textcolor{keyword}{auto} create\_subscriber\_with\_state(State\&\&        state,}
\DoxyCodeLine{110                                   OnNext\&\&      on\_next,}
\DoxyCodeLine{111                                   OnError\&\&     on\_error,}
\DoxyCodeLine{112                                   OnCompleted\&\& on\_completed)}
\DoxyCodeLine{113 \{}
\DoxyCodeLine{114     \textcolor{keywordflow}{return} create\_subscriber\_with\_state\_impl<Type>(std::forward<State>(state),}
\DoxyCodeLine{115                                                    std::forward<OnNext>(on\_next),}
\DoxyCodeLine{116                                                    std::forward<OnError>(on\_error),}
\DoxyCodeLine{117                                                    std::forward<OnCompleted>(on\_completed));}
\DoxyCodeLine{118 \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{120 \textcolor{keyword}{template}<constraint::decayed\_type                            Type, }
\DoxyCodeLine{121          constraint::decayed\_same\_as<composite\_subscription> Subscription,}
\DoxyCodeLine{122          \textcolor{keyword}{typename}                                            State,}
\DoxyCodeLine{123          std::invocable<Type, State>                         OnNext, }
\DoxyCodeLine{124          std::invocable<std::exception\_ptr, State>           OnError, }
\DoxyCodeLine{125          std::invocable<State>                               OnCompleted>}
\DoxyCodeLine{126 \textcolor{keyword}{auto} create\_subscriber\_with\_state(Subscription\&\& sub,}
\DoxyCodeLine{127                                   State\&\&        state,}
\DoxyCodeLine{128                                   OnNext\&\&       on\_next,}
\DoxyCodeLine{129                                   OnError\&\&      on\_error,}
\DoxyCodeLine{130                                   OnCompleted\&\&  on\_completed)}
\DoxyCodeLine{131 \{}
\DoxyCodeLine{132     \textcolor{keywordflow}{return} create\_subscriber\_with\_state\_impl<Type>(std::forward<State>(state),}
\DoxyCodeLine{133                                                    std::forward<OnNext>(on\_next),}
\DoxyCodeLine{134                                                    std::forward<OnError>(on\_error),}
\DoxyCodeLine{135                                                    std::forward<OnCompleted>(on\_completed),}
\DoxyCodeLine{136                                                    std::forward<Subscription>(sub));}
\DoxyCodeLine{137 \}}
\DoxyCodeLine{138 \} \textcolor{comment}{// namespace rpp::details}}

\end{DoxyCode}
